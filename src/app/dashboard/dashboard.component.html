<!-- Dashboard Header -->
<div class="dashboard-header">
  <h1>ðŸ’¸ OOpsMyMoney</h1>
  <p>Track your spending. Rule your wallet. Stay fabulous ðŸ’…</p>
</div>

<!-- Stat Summary -->
<div class="stat-summary-container">
  <div class="main-stat">
    <div class="label">This Month</div>
    <div class="value">â‚¹{{ monthlyTotal }}</div>
  </div>
  <div class="side-stats">
    <div class="side-stat">
      <div class="label small">This Year</div>
      <div class="value small">â‚¹{{ yearlyTotal }}</div>
    </div>
    <div class="side-stat">
      <div class="label small">All Time</div>
      <div class="value small">â‚¹{{ totalSpent }}</div>
    </div>
  </div>
</div>

<!-- Toggle Add Expense -->
<button class="button button-item" type="button" (click)="showForm = !showForm">
  <span class="button-bg"></span>
  <span class="button-inner">{{ showForm ? 'Cancel' : 'Add Expense' }}</span>
</button>

<!-- Add Expense Form -->
<form *ngIf="showForm" (submit)="submitExpense($event)" class="add-expense-form">
  <div>
    <label>Amount:</label>
    <input type="number" [(ngModel)]="newExpense.amount" name="amount" required />
  </div>

  <!-- Main Category -->
  <div>
    <label>Main Category:</label>
    <select [(ngModel)]="selectedCategoryId" name="mainCategory" required>
      <option value="" disabled>Select category</option>
      <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
    </select>

    <!-- Add/Delete Category Links -->
    <div class="category-links">
      <span 
        class="toggle-link add-category-link" 
        (click)="showMainCategoryInput = !showMainCategoryInput">
        + {{ showMainCategoryInput ? 'Cancel' : 'Add new main category' }}
      </span>
      <span 
        class="delete-link" 
        *ngIf="selectedCategoryId"
        (click)="deleteSelectedCategory()"
>
        - Delete existing category
      </span>
    </div>

    <!-- New Category Input -->
    <div *ngIf="showMainCategoryInput" class="new-category-input">
      <input type="text" [(ngModel)]="newCategory" name="newCategory" placeholder="Enter new main category" />
      <button type="button" (click)="addCategory()">Save Category</button>
    </div>
  </div>

  <!-- Subcategory -->
  <div *ngIf="selectedCategoryId">
    <label>Subcategory:</label>
    <input type="text" [(ngModel)]="selectedSubcategory" name="subcategory"
           (input)="filterSubcategorySuggestions()" placeholder="Type or select subcategory" required />
    <ul *ngIf="filteredSubcategories.length > 0" class="suggestion-list">
      <li *ngFor="let suggestion of filteredSubcategories" (click)="selectSubcategory(suggestion)">
        {{ suggestion }}
      </li>
    </ul>
  </div>

  <!-- Submit -->
  <button class="button button-item" type="submit">
    <span class="button-bg"></span>
    <span class="button-inner">Add Expense</span>
  </button>
</form>

<br>

<!-- Filter -->
<div class="filter-section">
  <label>Filter by:</label>
  <select [(ngModel)]="filterOption" (change)="applyFilter()">
    <option value="thisMonth">This Month</option>
    <option value="lastMonth">Last Month</option>
    <option value="thisYear">This Year</option>
    <option value="all">All Time</option>
  </select>
</div>

<!-- Spending by Category -->
<h3>Spending by Category</h3>
<ul class="category-totals">
  <li *ngFor="let key of categoryKeys()">
    {{ key }}: â‚¹{{ categoryTotals[key] }}
  </li>
</ul>

<!-- Chart -->
<button (click)="toggleChartType()">Switch to {{ chartType === 'pie' ? 'Bar' : 'Pie' }} Chart</button>
<div class="chart-wrapper">
  <canvas baseChart
    [data]="{ labels: chartLabels, datasets: [{ data: chartData, backgroundColor: ['#ff6384', '#36a2eb', '#ffce56', '#8e44ad', '#2ecc71', '#e67e22'] }] }"
    [type]="chartType"
    [options]="chartOptions">
  </canvas>
</div>

<!-- Expense List -->
<h3>All Expenses</h3>
<ul class="expense-list">
  <li *ngFor="let exp of filteredExpenses">
    â‚¹{{ exp.amount }} - {{ exp.category }} - {{ exp.date | date:'shortDate' }}
    <button (click)="editExpense(exp)">Edit</button>
    <button (click)="deleteExpense(exp)">Delete</button>
  </li>
</ul>

<!-- Edit Expense -->
<div *ngIf="editingExpense" class="edit-form">
  <h4>Edit Expense</h4>
  <form (ngSubmit)="submitEdit()">
    <input type="number" [(ngModel)]="editingExpense.amount" name="editAmount" required />
    <input type="text" [(ngModel)]="editingExpense.category" name="editCategory" placeholder="Category:Subcategory" />
    <button type="submit">Save</button>
    <button type="button" (click)="cancelEdit()">Cancel</button>
  </form>
</div>

<!-- Stat Box -->
<app-stat-box label="All Time" [value]="totalSpent"></app-stat-box>
